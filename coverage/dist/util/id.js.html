<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for dist/util/id.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">dist/util</a> id.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/62</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/61</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
<span class="cstat-no" title="statement not covered" >Object.defineProperty(exports, "__esModule", { value: true });</span>
const iterator_1 = <span class="cstat-no" title="statement not covered" >require("./iterator");</span>
const promisemap_1 = <span class="cstat-no" title="statement not covered" >require("./promisemap");</span>
const syncpromise_1 = <span class="cstat-no" title="statement not covered" >require("./syncpromise");</span>
function <span class="fstat-no" title="function not covered" >idMatchesMask(</span>id, mask) {
<span class="cstat-no" title="statement not covered" >    if (id.length !== mask.length)</span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
<span class="cstat-no" title="statement not covered" >    for (const [idc, maskc] of new iterator_1.CombinedIterator$(id, mask)) {</span>
<span class="cstat-no" title="statement not covered" >        if (maskc === '$')</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
<span class="cstat-no" title="statement not covered" >        if (maskc === '+' &amp;&amp; idc !== '0')</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
<span class="cstat-no" title="statement not covered" >        if (maskc === idc)</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
    }
<span class="cstat-no" title="statement not covered" >    return true;</span>
}
<span class="cstat-no" title="statement not covered" >exports.idMatchesMask = idMatchesMask;</span>
class IdFactory {
<span class="fstat-no" title="function not covered" >    co</span>nstructor(mask, initial) {
<span class="cstat-no" title="statement not covered" >        this.mask = mask;</span>
<span class="cstat-no" title="statement not covered" >        this.characters = ['-', '_'];</span>
<span class="cstat-no" title="statement not covered" >        this.ids = {</span>
            '00000000': true,
            '00000001': true,
        };
<span class="cstat-no" title="statement not covered" >        this.fillCharArray();</span>
<span class="cstat-no" title="statement not covered" >        if (initial != null)</span>
<span class="cstat-no" title="statement not covered" >            this.registerIds(initial);</span>
    }
<span class="fstat-no" title="function not covered" >    id</span>() {
<span class="cstat-no" title="statement not covered" >        while (true) {</span>
            let id = <span class="cstat-no" title="statement not covered" >'';</span>
<span class="cstat-no" title="statement not covered" >            for (const m of this.mask)</span>
<span class="cstat-no" title="statement not covered" >                id += this.getIdChar(m);</span>
<span class="cstat-no" title="statement not covered" >            if (this.ids[id])</span>
<span class="cstat-no" title="statement not covered" >                continue;</span>
<span class="cstat-no" title="statement not covered" >            this.ids[id] = true;</span>
<span class="cstat-no" title="statement not covered" >            return id;</span>
        }
    }
<span class="fstat-no" title="function not covered" >    re</span>gisterIds(ids) {
<span class="cstat-no" title="statement not covered" >        for (const id of ids)</span>
<span class="cstat-no" title="statement not covered" >            this.ids[id] = true;</span>
    }
<span class="fstat-no" title="function not covered" >    fi</span>llCharArray() {
<span class="cstat-no" title="statement not covered" >        for (let i = 48; i &lt; 58; i++)</span>
<span class="cstat-no" title="statement not covered" >            this.characters.push(String.fromCharCode(i));</span>
<span class="cstat-no" title="statement not covered" >        for (let i = 65; i &lt; 91; i++)</span>
<span class="cstat-no" title="statement not covered" >            this.characters.push(String.fromCharCode(i));</span>
<span class="cstat-no" title="statement not covered" >        for (let i = 97; i &lt; 123; i++)</span>
<span class="cstat-no" title="statement not covered" >            this.characters.push(String.fromCharCode(i));</span>
    }
<span class="fstat-no" title="function not covered" >    ge</span>tIdChar(mask) {
<span class="cstat-no" title="statement not covered" >        if (mask === '$')</span>
<span class="cstat-no" title="statement not covered" >            return this.characters[Math.floor(Math.random() * 64)];</span>
<span class="cstat-no" title="statement not covered" >        if (mask === '+')</span>
<span class="cstat-no" title="statement not covered" >            return this.characters[Math.floor(Math.random() * 63 + 1)];</span>
<span class="cstat-no" title="statement not covered" >        return mask;</span>
    }
}
<span class="cstat-no" title="statement not covered" >exports.IdFactory = IdFactory;</span>
class ResolvableIdFactory {
<span class="fstat-no" title="function not covered" >    co</span>nstructor(mask) {
<span class="cstat-no" title="statement not covered" >        this.promises = new promisemap_1.PromiseMap();</span>
<span class="cstat-no" title="statement not covered" >        this.idFactory = new IdFactory(mask);</span>
    }
<span class="fstat-no" title="function not covered" >    id</span>() {
        const tempId = <span class="cstat-no" title="statement not covered" >this.idFactory.id();</span>
        const promise = <span class="cstat-no" title="statement not covered" >this.promises.promise(tempId);</span>
<span class="cstat-no" title="statement not covered" >        return new ResolvingId(tempId, promise);</span>
    }
<span class="fstat-no" title="function not covered" >    re</span>solveIds(ids) {
        const resolvedKeys = <span class="cstat-no" title="statement not covered" >[];</span>
<span class="cstat-no" title="statement not covered" >        for (const [oldKey, newKey] of new iterator_1.CombinedIterator$(this.promises.keys(), ids)) {</span>
<span class="cstat-no" title="statement not covered" >            resolvedKeys.push(oldKey);</span>
<span class="cstat-no" title="statement not covered" >            this.promises.set(oldKey, [oldKey, newKey]);</span>
        }
<span class="cstat-no" title="statement not covered" >        for (const key of resolvedKeys)</span>
<span class="cstat-no" title="statement not covered" >            this.promises.delete(key);</span>
    }
}
<span class="cstat-no" title="statement not covered" >exports.ResolvableIdFactory = ResolvableIdFactory;</span>
class ResolvingId {
<span class="fstat-no" title="function not covered" >    co</span>nstructor(_id, promise = <span class="branch-0 cbranch-no" title="branch not covered" >syncpromise_1.SyncPromise.Resolve([_id, _id]))</span> {
<span class="cstat-no" title="statement not covered" >        this._id = _id;</span>
<span class="cstat-no" title="statement not covered" >        this.promise = promise;</span>
<span class="cstat-no" title="statement not covered" >        this.promise.then(<span class="fstat-no" title="function not covered" >id</span>s =&gt; <span class="cstat-no" title="statement not covered" >this._id = ids[1])</span>;</span>
    }
<span class="fstat-no" title="function not covered" >    ge</span>t id() {
<span class="cstat-no" title="statement not covered" >        return this._id;</span>
    }
}
<span class="cstat-no" title="statement not covered" >exports.ResolvingId = ResolvingId;</span>
//# sourceMappingURL=id.js.map</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Fri Jan 05 2018 16:54:03 GMT+0100 (STD)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
